<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.w3.org/MarkUp/SCHEMA/xhtml11.xsd"
     xml:lang="en">
  <head>
    <title>Information Center for ARM</title>
    <meta http-equiv="Content-Type" content="application/xhtml+xml; charset=utf-8" />
    <link type="text/css" rel="stylesheet" media="all" href="file://$TOOLKIT_DIR$/doc/infocenter/style/ewic.css" />
  </head>
  <body>
  <div id="topbanner"></div>
  <div id="titlebanner_small">
    <h2>Information Center for ARM</h2>
  </div>
  <div class="breadcrumb"><a href="$TOOLKIT_DIR$/doc/infocenter/index.ENU.html">Information Center for ARM</a> | EXAMPLES</div>
  <div class="mainblock">
   <h2>Example description</h2>

   <pre>  <!--Insert readme.txt-->
<span style="font-family: monospace;">
	ADC3 conversion using DMA for Data transfer

	Example Description

This example describes how to use the ADC3 and DMA to transfer continuously
converted data from ADC3 to memory.
The ADC3 is configured to convert continuously channel7(for STM324xG-EVAL
and STM32437I-EVAL)/channel8(for STM324x9I-EVAL).
Each time an end of conversion occurs the DMA transfers, in circular mode, the
converted data from ADC3 DR register to the uhADCxConvertedValue variable.

In this example, the system clock is 144MHz, APB2 = 72MHz and ADC clock = APB2/2.
Since ADC3 clock is 36 MHz and sampling time is set to 3 cycles, the conversion
time to 12bit data is 12 cycles so the total conversion time is (12+3)/36= 0.41us(2.4Msps).

User can vary the ADC3 channel7(for STM324xG-EVAL and STM32437I-EVAL)/channel8(for STM324x9I-EVAL)
voltage using the Eval Board potentiometer
The converted voltage is displayed on the Eval Board LCD (when the define USE_LCD
is enabled in main.h)


	Directory contents

  - ADC/ADC_DMA/system_stm32f4xx.c   STM32F4xx system clock configuration file
  - ADC/ADC_DMA/stm32f4xx_conf.h     Library Configuration file
  - ADC/ADC_DMA/stm32f4xx_it.c       Interrupt handlers
  - ADC/ADC_DMA/stm32f4xx_it.h       Interrupt handlers header file
  - ADC/ADC_DMA/main.c               Main program
  - ADC/ADC_DMA/main.h               Main program header file

 note The "system_stm32f4xx.c" is generated by an automatic clock configuration
      tool and can be easily customized to your own configuration.
      To select different clock setup, use the "STM32F4xx_Clock_Configuration_V1.1.0.xls"
      provided with the AN3988 package available on <a href="http://www.st.com">ST Website</a>

	Hardware and Software environment

  - This example runs on STM32F40xx/STM32F41xx, STM32F427x/STM32F437x,
    STM32F429x/STM32F439x Devices.

  - This example has been tested with STMicroelectronics STM324xG-EVAL (STM32F40xx/
    STM32F41xx Devices), STM32437I-EVAL (STM32F427x/STM32F437x Devices) and STM324x9I-EVAL
    (STM32F429x/STM32F439x Devices) evaluation boards and can be easily tailored to any
    other supported device and development board.

  - STM324xG-EVAL and STM32437I-EVAL Set-up
    - Use the Potentiometer (RV1) of the Eval board (connected to PF.09).

  - STM324x9I-EVAL Set-up
    - Use the Potentiometer (RV1) of the Eval board (connected to PF.10).


	How to use it ?

In order to make the program work, you must do the following :
 - Copy all source files from this example folder to the template folder under
   Project\STM32F4xx_StdPeriph_Templates
 - Open your preferred toolchain
 - Rebuild all files and load your image into target memory
 - Run the example


===============================================================================


	Use ADC1 and ADC2 in Dual interleaved mode and DMA mode3

	Example Description

This example provides a short description of how to use the ADC peripheral to
convert a regular channel in Dual interleaved mode using DMA in mode 3 with 5Msps.

DMA mode 3 is used in interleaved mode in 6-bit and 8-bit resolutions.

The Dual interleaved delay is configured 6 ADC clk cycles.

On each DMA request (two data items are available) two bytes representing two
ADC-converted data items are transferred as a half word.
The data transfer order is similar to that of the DMA mode 2.

A DMA request is generated each time 2 data items are available
1st request: ADC_CDR[15:0] = (ADC2_DR[7:0] &lt;&lt; 8) | ADC1_DR[7:0]
2nd request: ADC_CDR[15:0] = (ADC2_DR[7:0] &lt;&lt; 8) | ADC1_DR[7:0]

The ADC1 and ADC2 are configured to convert ADC Channel 12, with conversion
triggered by software.
By this way, ADC channel 12 is converted each 6 cycles.

In this example, the system clock is 144MHz, APB2 =72MHz and ADC clock = APB2 /2.
Since ADCCLK= 36MHz and Conversion rate = 6 cycle
==> Conversion Time = 36M/6cyc = 6Msps.

 note Refer to "simulation.xls" file to have the diagram simulation of the example.


	Directory contents

  - ADC/ADC_DualModeInterleaved/system_stm32f4xx.c   STM32F4xx system clock configuration file
  - ADC/ADC_DualModeInterleaved/stm32f4xx_conf.h     Library Configuration file
  - ADC/ADC_DualModeInterleaved/stm32f4xx_it.h       Interrupt handlers header file
  - ADC/ADC_DualModeInterleaved/stm32f4xx_it.c       Interrupt handlers
  - ADC/ADC_DualModeInterleaved/main.c               Main program
  - ADC/ADC_DualModeInterleaved/main.h               Main program header file

 note The "system_stm32f4xx.c" is generated by an automatic clock configuration
      tool and can be easily customized to your own configuration.
      To select different clock setup, use the "STM32F4xx_Clock_Configuration_V1.1.0.xls"
      provided with the AN3988 package available on <a href="http://www.st.com">ST Website</a>

	Hardware and Software environment

  - This example runs on STM32F40xx/STM32F41xx, STM32F427x/STM32F437x,
    STM32F429x/STM32F439x Devices.

  - This example has been tested with STMicroelectronics STM324xG-EVAL (STM32F40xx/
    STM32F41xx Devices), STM32437I-EVAL (STM32F427x/STM32F437x Devices) and STM324x9I-EVAL
    (STM32F429x/STM32F439x Devices) evaluation boards and can be easily tailored to any
    other supported device and development board.

  - STM324xG-EVAL, STM32437I-EVAL and STM324x9I-EVAL Set-up
    - Connect PC.2 to a power supply (do not forget to connect the power supply
      GND to the EVAL board GND)


	How to use it ?

In order to make the program work, you must do the following :
 - Copy all source files from this example folder to the template folder under
   Project\STM32F4xx_StdPeriph_Templates
 - Open your preferred toolchain
 - Rebuild all files and load your image into target memory
 - Run the example


===============================================================================


	Use ADC1 and ADC2 in Dual regular simultaneous mode and DMA mode1

	Example Description

This example provides a short description of how to use the ADC peripheral to
convert regular channels simultaneously in dual mode using DMA in mode 1.

Regular simultaneous mode is performed on a regular group of channels.
In Dual ADC mode, ADC1 data are transferred on the first request, ADC2 data are
transferred on the second request and so on.
On each DMA request (one data item is available), a half-word representing an
ADC-converted data item is transferred.
The conversion is triggered by software.

The ADC1 is configured to convert ADC Channel 10 and 11.
The ADC2 is configured to convert ADC Channel 11 and 12.

Note: the sequence length must be the same for both ADCs

In this example, the system clock is 144MHz, APB2 =72MHz and ADC clock = APB2 /2.
So ADCCLK= 36MHz

Conversion rate of channel 10 and 12 = 30 cycles => Conversion Time = 36M/30cyc = 1.2Msps.
Conversion rate of channel 11 = 15 cycles => Conversion Time = 36M/15cyc = 2.4Msps.

 note Refer to "simulation.xls" file to have the diagram simulation of the example.


	Directory contents

  - ADC/ADC_DualModeRegulSimu/system_stm32f4xx.c   STM32F4xx system clock configuration file
  - ADC/ADC_DualModeRegulSimu/stm32f4xx_conf.h     Library Configuration file
  - ADC/ADC_DualModeRegulSimu/stm32f4xx_it.h       Interrupt handlers header file
  - ADC/ADC_DualModeRegulSimu/stm32f4xx_it.c       Interrupt handlers
  - ADC/ADC_DualModeRegulSimu/main.c               Main program


 note The "system_stm32f4xx.c" is generated by an automatic clock configuration
      tool and can be easily customized to your own configuration.
      To select different clock setup, use the "STM32F4xx_Clock_Configuration_V1.1.0.xls"
      provided with the AN3988 package available on <a href="http://www.st.com">ST Website</a>


	Hardware and Software environment

  - This example runs on STM32F40xx/STM32F41xx, STM32F427x/STM32F437x,
    STM32F429x/STM32F439x Devices.

  - This example has been tested with STMicroelectronics STM324xG-EVAL (STM32F40xx/
    STM32F41xx Devices), STM32437I-EVAL (STM32F427x/STM32F437x Devices) and STM324x9I-EVAL
    (STM32F429x/STM32F439x Devices) evaluation boards and can be easily tailored to any
    other supported device and development board.

  - STM324xG-EVAL, STM32437I-EVAL and STM324x9I-EVAL Set-up
    - Connect PC.0, PC.1 and PC.2 to a power supply (do not forget to connect the
      power supply GND to the EVAL board GND)


	How to use it ?

In order to make the program work, you must do the following :
 - Copy all source files from this example folder to the template folder under
   Project\STM32F4xx_StdPeriph_Templates
 - Open your preferred toolchain
 - Rebuild all files and load your image into target memory
 - Run the example


===============================================================================


	Use ADC1, ADC2 and ADC3 in Triple interleaved mode and DMA mode2 with 6Msps

	Example Description

This example provides a short description of how to use the ADC peripheral to
convert a regular channel in Triple interleaved mode using DMA in mode 2 with
6Msps .

The Triple interleaved delay is configured 5 ADC clk cycles.

In Triple ADC mode, three DMA requests are generated:
- On the first request, both ADC2 and ADC1 data are transferred (ADC2 data take
  the upper half-word and ADC1 data take the lower half-word).
- On the second request, both ADC1 and ADC3 data are transferred (ADC1 data take
  the upper half-word and ADC3 data take the lower half-word).
- On the third request, both ADC3 and ADC2 data are transferred (ADC3 data take
  the upper half-word and ADC2 data take the lower half-word) and so on.

On each DMA request (two data items are available) two half-words representing
two ADC-converted data items are transferred as a word.

A DMA request is generated each time 2 data items are available :
1st request: ADC_CDR[31:0] = (ADC2_DR[15:0] &lt;&lt; 16) | ADC1_DR[15:0] (step1)
2nd request: ADC_CDR[31:0] = (ADC1_DR[15:0] &lt;&lt; 16) | ADC3_DR[15:0] (step2)
3rd request: ADC_CDR[31:0] = (ADC3_DR[15:0] &lt;&lt; 16) | ADC2_DR[15:0] (step3)
4th request: ADC_CDR[31:0] = (ADC2_DR[15:0] &lt;&lt; 16) | ADC1_DR[15:0] (step1) and so on.

The conversion is triggered by software.

The ADC1, ADC2 and ADC3 are configured to convert ADC Channel 12.
By this way, the ADC can reach 6Msps, in fact the same channel is converted
each 5 cycles

In this example, the system clock is 144MHz, APB2 = 72MHz and ADC clock = APB2 /2.
Since ADCCLK= 36MHz and Conversion rate = 5 cycles
==> Conversion Time = 36M/5cyc = 7.2Msps

 note Refer to "simulation.xls" file to have the diagram simulation of the example.


	Directory contents

  - ADC/ADC_TripleModeInterleaved/system_stm32f4xx.c   STM32F4xx system clock configuration file
  - ADC/ADC_TripleModeInterleaved/stm32f4xx_conf.h     Library Configuration file
  - ADC/ADC_TripleModeInterleaved/stm32f4xx_it.h       Interrupt handlers header file
  - ADC/ADC_TripleModeInterleaved/stm32f4xx_it.c       Interrupt handlers
  - ADC/ADC_TripleModeInterleaved/main.c               Main program
  - ADC/ADC_TripleModeInterleaved/main.h               Main program header file

 note The "system_stm32f4xx.c" is generated by an automatic clock configuration
      tool and can be easily customized to your own configuration.
      To select different clock setup, use the "STM32F4xx_Clock_Configuration_V1.1.0.xls"
      provided with the AN3988 package available on <a href="http://www.st.com">ST Website</a>


	Hardware and Software environment

  - This example runs on STM32F40xx/STM32F41xx, STM32F427x/STM32F437x,
    STM32F429x/STM32F439x Devices.

  - This example has been tested with STMicroelectronics STM324xG-EVAL (STM32F40xx/
    STM32F41xx Devices), STM32437I-EVAL (STM32F427x/STM32F437x Devices) and STM324x9I-EVAL
    (STM32F429x/STM32F439x Devices) evaluation boards and can be easily tailored to any
    other supported device and development board.

  - STM324xG-EVAL, STM32437I-EVAL and STM324x9I-EVAL Set-up
    - Connect PC.2 to a power supply (do not forget to connect the power supply GND
      to the EVAL board GND)


	How to use it ?

In order to make the program work, you must do the following :
 - Copy all source files from this example folder to the template folder under
   Project\STM32F4xx_StdPeriph_Templates
 - Open your preferred toolchain
 - Rebuild all files and load your image into target memory
 - Run the example


===============================================================================


	ADC VBAT Measurement

	Example Description

This example describes how to measure VBAT voltage using ADC1 regular channel 18.
In fact, the measured value correspond to VBAT/2 for STM32F40xx/STM32F41xx devices and
to VBAT/4 for STM32F42xx/STM32F43xx devices; as the VBAT voltage could be higher
than VDDA, to ensure the correct operation of the ADC, the VBAT pin is internally
connected to a bridge divider by 2 for STM32F40xx/STM32F41xx devices and by 4
for STM32F42xx/STM32F43xx devices.

In this example the VBAT/2 voltage for STM32F40xx/STM32F41xx devices or VBAT/4 voltage
for STM32F42xx/STM32F43xx devices is continuously converted, each time an end
of conversion occurs the DMA transfers, in circular mode, the converted data from
ADC1 DR register to the uwADCConvertedValue variable.
However, in real application to prevent any unwanted consumption on the battery,
it is recommended to enable the bridge divider only when needed for ADC
conversion then disable it.

User can display the VBAT voltage on the Eval Board LCD (when the define USE_LCD
is enabled in main.h)

In this example, the system clock is 144MHz, APB2 =72MHz and ADC clock = APB2 /2.
So ADCCLK= 36MHz

Conversion rate of Vbat channel  = Sampling Time + Conversion Time = 15 + 12 cycles
                                 = 27 cycles ==> Conversion Time = 36MHz/27cyc = 1.33Msps.


	Directory contents

  - ADC/ADC_VBATMeasurement/system_stm32f4xx.c   STM32F4xx system clock configuration file
  - ADC/ADC_VBATMeasurement/stm32f4xx_conf.h     Library Configuration file
  - ADC/ADC_VBATMeasurement/stm32f4xx_it.c       Interrupt handlers
  - ADC/ADC_VBATMeasurement/stm32f4xx_it.h       Interrupt handlers header file
  - ADC/ADC_VBATMeasurement/main.c               Main program
  - ADC/ADC_VBATMeasurement/main.h               Main program header file

 note The "system_stm32f4xx.c" is generated by an automatic clock configuration
      tool and can be easily customized to your own configuration.
      To select different clock setup, use the "STM32F4xx_Clock_Configuration_V1.1.0.xls"
      provided with the AN3988 package available on <a href="http://www.st.com">ST Website</a>


	Hardware and Software environment

  - This example runs on STM32F40xx/STM32F41xx, STM32F427x/STM32F437x,
    STM32F429x/STM32F439x Devices.

  - This example has been tested with STMicroelectronics STM324xG-EVAL (STM32F40xx/
    STM32F41xx Devices), STM32437I-EVAL (STM32F427x/STM32F437x Devices) and STM324x9I-EVAL
    (STM32F429x/STM32F439x Devices) evaluation boards and can be easily tailored to any
    other supported device and development board.


	How to use it ?

In order to make the program work, you must do the following :
 - Copy all source files from this example folder to the template folder under
   Project\STM32F4xx_StdPeriph_Templates
 - Open your preferred toolchain
 - Rebuild all files and load your image into target memory
 - Run the example

</span>
  </pre>
  </div>
  </body>
</html>

